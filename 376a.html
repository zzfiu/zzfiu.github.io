<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="renderer" content="webkit"><meta name="force-rendering" content="webkit"><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="HandheldFriendly" content="True"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><title>宝塔Docker自建Bitwarden密码管理服务 | ���ӷ�</title><link rel="stylesheet" href="/css/style/main.css"><link rel="stylesheet" id="hl-default-theme" href="/css/highlight/solarized-light.css" media="none"><link rel="stylesheet" id="hl-dark-theme" href="/css/highlight/solarized-dark.css" media="none"><link rel="stylesheet" href="/css/style/dark.css"><script src="/js/darkmode.js"></script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="app"><header class="header"><div class="header__left"><a href="/" class="button"><span class="logo__text">张子枫</span></a></div><div class="header__right"><div class="navbar__menus"><a href="/" class="navbar-menu button">首页</a> <a href="/tags/" class="navbar-menu button">标签</a> <a href="/archives/" class="navbar-menu button">归档</a> <a href="/friends/" class="navbar-menu button">友链</a> <a href="/page/" class="navbar-menu button">Page</a></div><a href="javaScript:void(0);" id="btn-toggle-dark"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg></a><a href="#" class="button" id="b2t" aria-label="回到顶部" title="回到顶部"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" width="32" height="32"><path d="M233.376 722.752 278.624 768 512 534.624 745.376 768l45.248-45.248L512 444.128zM192 352h640V288H192z" fill="currentColor"></path></svg></a><a class="dropdown-icon button" id="btn-dropdown" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="24" height="24" fill="none" stroke="currentColor" stroke-width="0.7" stroke-linecap="round" stroke-linejoin="round"><path fill="currentColor" d="M3.314 4.8h13.372c.41 0 .743-.333.743-.743 0-.41-.333-.743-.743-.743H3.314c-.41 0-.743.333-.743.743C2.571 4.467 2.904 4.8 3.314 4.8zM16.686 15.2H3.314c-.41 0-.743.333-.743.743s.333.743.743.743h13.372c.41 0 .743-.333.743-.743S17.096 15.2 16.686 15.2zM16.686 9.257H3.314c-.41 0-.743.333-.743.743s.333.743.743.743h13.372c.41 0 .743-.333.743-.743S17.096 9.257 16.686 9.257z"></path></svg></a><div class="dropdown-menus" id="dropdown-menus"><a href="/" class="dropdown-menu button">首页</a> <a href="/tags/" class="dropdown-menu button">标签</a> <a href="/archives/" class="dropdown-menu button">归档</a> <a href="/friends/" class="dropdown-menu button">友链</a> <a href="/page/" class="dropdown-menu button">Page</a></div></div></header><main class="main"><div class="post-title"><h1 class="post-title__text">宝塔Docker自建Bitwarden密码管理服务</h1><div class="post-title__meta"><a href="/archives/2021/05/" class="post-meta__date button">2021-05-23</a></div></div><aside class="post-side"><div class="post-side__toc"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-BitWarden%E5%A5%BD%E5%A4%84%E9%83%BD%E6%9C%89%E5%95%A5%EF%BC%9F"><span class="toc-number">1.</span> <span class="toc-text">1. BitWarden好处都有啥？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%AE%9D%E5%A1%94%E5%AE%89%E8%A3%85Docker"><span class="toc-number">2.</span> <span class="toc-text">2. 宝塔安装Docker</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E8%8E%B7%E5%8F%96%E9%95%9C%E5%83%8F"><span class="toc-number">3.</span> <span class="toc-text">3. 获取镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%88%9B%E5%BB%BA%E5%AE%B9%E5%99%A8"><span class="toc-number">4.</span> <span class="toc-text">4.创建容器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E6%B7%BB%E5%8A%A0%E7%AB%99%E7%82%B9"><span class="toc-number">5.</span> <span class="toc-text">5.添加站点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E5%90%AF%E7%94%A8CDN"><span class="toc-number">6.</span> <span class="toc-text">6. 启用CDN</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%BF%80%E6%B4%BB%E6%9C%8D%E5%8A%A1"><span class="toc-number">6.1.</span> <span class="toc-text">1. 激活服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%B7%BB%E5%8A%A0%E5%9F%9F%E5%90%8D"><span class="toc-number">6.2.</span> <span class="toc-text">2. 添加域名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E7%BC%93%E5%AD%98%E9%85%8D%E7%BD%AE"><span class="toc-number">6.3.</span> <span class="toc-text">3. 缓存配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90"><span class="toc-number">6.4.</span> <span class="toc-text">4. 域名解析</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E5%85%B3%E9%97%AD%E6%B3%A8%E5%86%8C"><span class="toc-number">7.</span> <span class="toc-text">7. 关闭注册</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%88%A0%E9%99%A4%E5%AE%B9%E5%99%A8"><span class="toc-number">7.1.</span> <span class="toc-text">1. 删除容器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E9%87%8D%E6%96%B0%E8%BF%90%E8%A1%8C%E5%AE%B9%E5%99%A8"><span class="toc-number">7.2.</span> <span class="toc-text">2. 重新运行容器</span></a></li></ol></li></ol></div></aside><a class="btn-toc button" id="btn-toc" tabindex="0"><svg viewBox="0 0 1024 1024" width="32" height="32" xmlns="http://www.w3.org/2000/svg"><path d="M128 256h64V192H128zM320 256h576V192H320zM128 544h64v-64H128zM320 544h576v-64H320zM128 832h64v-64H128zM320 832h576v-64H320z" fill="currentColor"></path></svg></a><div class="toc-menus" id="toc-menus"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-BitWarden%E5%A5%BD%E5%A4%84%E9%83%BD%E6%9C%89%E5%95%A5%EF%BC%9F"><span class="toc-number">1.</span> <span class="toc-text">1. BitWarden好处都有啥？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%AE%9D%E5%A1%94%E5%AE%89%E8%A3%85Docker"><span class="toc-number">2.</span> <span class="toc-text">2. 宝塔安装Docker</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E8%8E%B7%E5%8F%96%E9%95%9C%E5%83%8F"><span class="toc-number">3.</span> <span class="toc-text">3. 获取镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%88%9B%E5%BB%BA%E5%AE%B9%E5%99%A8"><span class="toc-number">4.</span> <span class="toc-text">4.创建容器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E6%B7%BB%E5%8A%A0%E7%AB%99%E7%82%B9"><span class="toc-number">5.</span> <span class="toc-text">5.添加站点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E5%90%AF%E7%94%A8CDN"><span class="toc-number">6.</span> <span class="toc-text">6. 启用CDN</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%BF%80%E6%B4%BB%E6%9C%8D%E5%8A%A1"><span class="toc-number">6.1.</span> <span class="toc-text">1. 激活服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%B7%BB%E5%8A%A0%E5%9F%9F%E5%90%8D"><span class="toc-number">6.2.</span> <span class="toc-text">2. 添加域名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E7%BC%93%E5%AD%98%E9%85%8D%E7%BD%AE"><span class="toc-number">6.3.</span> <span class="toc-text">3. 缓存配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90"><span class="toc-number">6.4.</span> <span class="toc-text">4. 域名解析</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E5%85%B3%E9%97%AD%E6%B3%A8%E5%86%8C"><span class="toc-number">7.</span> <span class="toc-text">7. 关闭注册</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%88%A0%E9%99%A4%E5%AE%B9%E5%99%A8"><span class="toc-number">7.1.</span> <span class="toc-text">1. 删除容器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E9%87%8D%E6%96%B0%E8%BF%90%E8%A1%8C%E5%AE%B9%E5%99%A8"><span class="toc-number">7.2.</span> <span class="toc-text">2. 重新运行容器</span></a></li></ol></li></ol></div><article class="post post__with-toc content-card"><div class="post__header"></div><div class="post__content"><p><a target="_blank" rel="noopener" href="https://bitwarden.com/">Bitwarden</a>是一个跨平台的密码管理软件，类似于 1Password、EnPass、LastPass 等。Bitwarden 是免费开源的，可以将服务端部署在自己的服务器上，比如群晖，并且支持 Docker 部署。但官方的镜像要求至少 2G 以上内存，要求比较高。有人用 Rust 实现了 Bitwarden 服务器，项目叫 <a target="_blank" rel="noopener" href="https://github.com/dani-garcia/bitwarden_rs">bitwarden_rs</a>，并且提供了 Docker 镜像，这个实现更进一步降低了对机器配置的要求，并且 Docker 镜像体积很小，部署非常方便。另外可以用腾讯云 <a target="_blank" rel="noopener" href="https://console.cloud.tencent.com/cdn/access">CDN</a>服务隐藏我们的服务器真实IP以及实现访问加速。</p><h3 id="1-BitWarden好处都有啥？"><a href="#1-BitWarden好处都有啥？" class="headerlink" title="1. BitWarden好处都有啥？"></a>1. BitWarden好处都有啥？</h3><ul><li>开源（好像是大部分开源）</li><li>可以自建</li><li>不要钱（指自建就不需要额外花钱买服务）</li><li>客户端比LastPass好看+好用</li><li>可以同步TOTP密钥</li><li>官方服务器中需要付费订阅的一些功能，在自建中是免费的</li></ul><h3 id="2-宝塔安装Docker"><a href="#2-宝塔安装Docker" class="headerlink" title="2. 宝塔安装Docker"></a>2. 宝塔安装Docker</h3><p>进入到宝塔面板的软件商店，搜索docker安装即可</p><p><img src="https://img.zzf.red//20200801011631.png#vwid=1247&vhei=489" class="lazy" data-srcset="https://img.zzf.red//20200801011631.png#vwid=1247&vhei=489" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABAQMAAAAl21bKAAAABlBMVEXMzMyWlpYU2uzLAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAACklEQVQImWNgAAAAAgAB9HFkpgAAAABJRU5ErkJggg=="></p><h3 id="3-获取镜像"><a href="#3-获取镜像" class="headerlink" title="3. 获取镜像"></a>3. 获取镜像</h3><p>打开docker管理器，点击获取镜像，输入Bitwarden_rs的官方镜像<code>bitwardenrs/server</code>后点击获取镜像。</p><p><img src="https://img.zzf.red//20200801011742.png#vwid=850&vhei=596" class="lazy" data-srcset="https://img.zzf.red//20200801011742.png#vwid=850&vhei=596" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABAQMAAAAl21bKAAAABlBMVEXMzMyWlpYU2uzLAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAACklEQVQImWNgAAAAAgAB9HFkpgAAAABJRU5ErkJggg==" alt="c14a8df9528d3"></p><h3 id="4-创建容器"><a href="#4-创建容器" class="headerlink" title="4.创建容器"></a>4.创建容器</h3><p>1.点击创建容器按钮<br>2.填写端口映射中的 <code>容器端口</code>：<code>80</code>,<code>服务端口</code>：<code>6666</code>6666可以自定义<br>3.填写目录映射中的<code>服务器目录</code>：<code>/www/wwwroot/xxx.zzf.red</code>(该目录可以自定义，这里用网址作为目录)，<code>容器目录</code>：<code>/data</code><br>4.填写内存配额，根据自己服务器的配置按需填写<br>5.提交创建容器<br>6.点击容器名称，修改容器名称为<code>Bitwarden</code>以方便辨认<br><img src="https://img.zzf.red//20200801012025.png#vwid=631&vhei=719" class="lazy" data-srcset="https://img.zzf.red//20200801012025.png#vwid=631&vhei=719" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABAQMAAAAl21bKAAAABlBMVEXMzMyWlpYU2uzLAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAACklEQVQImWNgAAAAAgAB9HFkpgAAAABJRU5ErkJggg==" alt="Snipaste_2020-08-01_01-20-05"></p><h3 id="5-添加站点"><a href="#5-添加站点" class="headerlink" title="5.添加站点"></a>5.添加站点</h3><p>在宝塔里面添加一个站点，FTP、数据库均不用创建，PHP版本选择纯静态。目录选择刚才创建的服务器目录</p><p>网站添加完成后设置SSL，自己准备证书，或者用免费的Let’s Encrypt，设置完毕后开启强制Https。</p><p>最后添加一个反向代理，名称随意填，目标URL为<code>http://127.0.0.1:6666</code>，端口号和上面<code>创建容器</code>时<code>服务端口</code>保持一致。<img src="https://img.zzf.red//20200801013443.png#vwid=806&vhei=569" class="lazy" data-srcset="https://img.zzf.red//20200801013443.png#vwid=806&vhei=569" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABAQMAAAAl21bKAAAABlBMVEXMzMyWlpYU2uzLAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAACklEQVQImWNgAAAAAgAB9HFkpgAAAABJRU5ErkJggg==" alt="Snipaste_2020-08-01_01-34-09"></p><p><strong>上述步骤都做完后别忘了在宝塔面板安全-防火墙中放行端口<code>6666</code>。</strong></p><h3 id="6-启用CDN"><a href="#6-启用CDN" class="headerlink" title="6. 启用CDN"></a>6. 启用CDN</h3><p><strong>CDN配置步骤如下：</strong></p><h4 id="1-激活服务"><a href="#1-激活服务" class="headerlink" title="1. 激活服务"></a>1. 激活服务</h4><p>打开腾讯云CDN管理界面，确认已经激活服务：<a target="_blank" rel="noopener" href="https://console.cloud.tencent.com/cdn/access">https://console.cloud.tencent.com/cdn/access</a></p><h4 id="2-添加域名"><a href="#2-添加域名" class="headerlink" title="2. 添加域名"></a>2. 添加域名</h4><p>点击添加域名：<code>xxx.zzf.red</code> 如图：</p><ul><li>源站地址填写服务器IP+上文bitwarden容器的<code>服务端口</code>6666</li><li>回源协议选择 HTTP</li></ul><h4 id="3-缓存配置"><a href="#3-缓存配置" class="headerlink" title="3. 缓存配置"></a>3. 缓存配置</h4><ul><li>将全部类型-所有文件的刷新时间改为0天，即不缓存</li><li>新增一个文件类型，内容为：.jpg;.png;.css;.woff;.woff2;.svg，刷新时间设置为30天或更长，即静态文件缓存到CDN</li><li>调整下优先级，确保需要缓存的规则放到最前，全部-所有文件这个兜底类型放到最后。<h4 id="4-域名解析"><a href="#4-域名解析" class="headerlink" title="4. 域名解析"></a>4. 域名解析</h4>在基本配置界面找到CDN给分配的CNAME地址，然后前往你的DNS管理添加 <code>CNAME</code>记录 名字为你的网站前缀，记录值为DN给分配的CNAME地址</li></ul><p><strong>做完以上配置，我们就可以正常访问Bitwarden的后台管理了</strong></p><h3 id="7-关闭注册"><a href="#7-关闭注册" class="headerlink" title="7. 关闭注册"></a>7. 关闭注册</h3><p>最后，因为我们部署Bitwarden是私人使用场景，因此需要修改下Bitwarden的容器启动脚本，将前面的SIGNUPS_ALLOWED=true改为SIGNUPS_ALLOWED=false，也就是禁止用户注册。具体步骤如下：</p><h4 id="1-删除容器"><a href="#1-删除容器" class="headerlink" title="1. 删除容器"></a>1. 删除容器</h4><p>在docker管理器中点击刚才创建的容器的状态绿色图标，停止容器运行，然后删除容器（删除容器后不会删除数据）</p><h4 id="2-重新运行容器"><a href="#2-重新运行容器" class="headerlink" title="2. 重新运行容器"></a>2. 重新运行容器</h4><p>在VPS中运行下面的命令重新运行容器，其中<code>Bitwarden</code>为容器的名字，<code>SIGNUPS_ALLOWED=false</code>代表禁止注册，<code>/www/wwwroot/xxx.zzf.red</code>为上面创建容器时所写的<code>服务器目录</code>,<code>/data</code>为容器目录，<code>6666:80</code>代表上面创建容器时的<code>服务端口:容器端口</code></p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name Bitwarden \</span><br><span class="line">  -e SIGNUPS_ALLOWED=<span class="keyword">false</span> \</span><br><span class="line">  -v <span class="regexp">/www/</span>wwwroot<span class="regexp">/xxx.zzf.red/</span>:<span class="regexp">/data/</span> \</span><br><span class="line">  -p <span class="number">6666</span>:<span class="number">80</span> \</span><br><span class="line">  bitwardenrs/server:latest</span><br></pre></td></tr></table></figure><p>运行完成后在容器列表里就又能看到了。<br>然后再去试下创建账号就会出现一个不能创建账号的错误提示。</p></div><div class="post-footer__meta"><p>更新于 2021-05-23</p></div><div class="post-meta__cats"></div></article><div class="nav"><div class="nav__prev"></div><div class="nav__next"><a href="/9d46.html" class="nav__link"><div><div class="nav__label">Next Post</div><div class="nav__title">VPS 手动在线一键重装系统脚本整理</div></div><div><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="24" height="24"><path d="M434.944 790.624l-45.248-45.248L623.04 512l-233.376-233.376 45.248-45.248L713.568 512z" fill="#808080"></path></svg></div></a></div></div></main><footer class="footer"><p class="footer-copyright">Copyright © 2020&nbsp;-&nbsp;2021 <a href="/">���ӷ�</a></p><p>Powered by <a href="https://hexo.io" target="_blank">Hexo</a> | Theme - <a href="https://github.com/ChrAlpha/hexo-theme-cards" target="_blank">Cards</a></p></footer></div><script defer src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@17.1.0/dist/lazyload.min.js"></script><script>window.lazyLoadOptions={elements_selector:".lazy",threshold:0}</script></body></html>