<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="renderer" content="webkit"><meta name="force-rendering" content="webkit"><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="HandheldFriendly" content="True"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><title>基于CloudFlare的DDNS解析 进阶版 | ���ӷ�</title><link rel="stylesheet" href="/css/style/main.css"><link rel="stylesheet" id="hl-default-theme" href="/css/highlight/solarized-light.css" media="none"><link rel="stylesheet" id="hl-dark-theme" href="/css/highlight/solarized-dark.css" media="none"><link rel="stylesheet" href="/css/style/dark.css"><script src="/js/darkmode.js"></script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="app"><header class="header"><div class="header__left"><a href="/" class="button"><span class="logo__text">张子枫</span></a></div><div class="header__right"><div class="navbar__menus"><a href="/" class="navbar-menu button">首页</a> <a href="/tags/" class="navbar-menu button">标签</a> <a href="/archives/" class="navbar-menu button">归档</a> <a href="/friends/" class="navbar-menu button">友链</a> <a href="/page/" class="navbar-menu button">Page</a></div><a href="javaScript:void(0);" id="btn-toggle-dark"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg></a><a href="#" class="button" id="b2t" aria-label="回到顶部" title="回到顶部"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" width="32" height="32"><path d="M233.376 722.752 278.624 768 512 534.624 745.376 768l45.248-45.248L512 444.128zM192 352h640V288H192z" fill="currentColor"></path></svg></a><a class="dropdown-icon button" id="btn-dropdown" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="24" height="24" fill="none" stroke="currentColor" stroke-width="0.7" stroke-linecap="round" stroke-linejoin="round"><path fill="currentColor" d="M3.314 4.8h13.372c.41 0 .743-.333.743-.743 0-.41-.333-.743-.743-.743H3.314c-.41 0-.743.333-.743.743C2.571 4.467 2.904 4.8 3.314 4.8zM16.686 15.2H3.314c-.41 0-.743.333-.743.743s.333.743.743.743h13.372c.41 0 .743-.333.743-.743S17.096 15.2 16.686 15.2zM16.686 9.257H3.314c-.41 0-.743.333-.743.743s.333.743.743.743h13.372c.41 0 .743-.333.743-.743S17.096 9.257 16.686 9.257z"></path></svg></a><div class="dropdown-menus" id="dropdown-menus"><a href="/" class="dropdown-menu button">首页</a> <a href="/tags/" class="dropdown-menu button">标签</a> <a href="/archives/" class="dropdown-menu button">归档</a> <a href="/friends/" class="dropdown-menu button">友链</a> <a href="/page/" class="dropdown-menu button">Page</a></div></div></header><main class="main"><div class="post-title"><h1 class="post-title__text">基于CloudFlare的DDNS解析 进阶版</h1><div class="post-title__meta"><a href="/archives/2021/05/" class="post-meta__date button">2021-05-22</a></div></div><aside class="post-side"><div class="post-side__toc"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E6%8F%90%E6%9D%A1%E4%BB%B6"><span class="toc-number">1.</span> <span class="toc-text">前提条件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E8%8E%B7%E5%8F%96CFKEY"><span class="toc-number">1.1.</span> <span class="toc-text">1. 获取CFKEY</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E8%AE%BE%E7%BD%AE%E7%94%A8%E4%BA%8E-DDNS-%E8%A7%A3%E6%9E%90%E7%9A%84%E4%BA%8C%E7%BA%A7%E5%9F%9F%E5%90%8D"><span class="toc-number">1.2.</span> <span class="toc-text">2. 设置用于 DDNS 解析的二级域名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E4%B8%8B%E8%BD%BD-DDNS-%E8%84%9A%E6%9C%AC"><span class="toc-number">1.3.</span> <span class="toc-text">3. 下载 DDNS 脚本</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E4%BF%AE%E6%94%B9-DDNS-%E8%84%9A%E6%9C%AC%E5%B9%B6%E5%A1%AB%E5%86%99%E7%9B%B8%E5%85%B3%E4%BF%A1%E6%81%AF"><span class="toc-number">1.4.</span> <span class="toc-text">4. 修改 DDNS 脚本并填写相关信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E8%84%9A%E6%9C%AC%E6%8E%88%E6%9D%83%E5%B9%B6%E6%89%A7%E8%A1%8C"><span class="toc-number">1.5.</span> <span class="toc-text">5. 脚本授权并执行</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E8%AE%BE%E7%BD%AE%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1"><span class="toc-number">1.6.</span> <span class="toc-text">6. 设置定时任务</span></a></li></ol></li></ol></div></aside><a class="btn-toc button" id="btn-toc" tabindex="0"><svg viewBox="0 0 1024 1024" width="32" height="32" xmlns="http://www.w3.org/2000/svg"><path d="M128 256h64V192H128zM320 256h576V192H320zM128 544h64v-64H128zM320 544h576v-64H320zM128 832h64v-64H128zM320 832h576v-64H320z" fill="currentColor"></path></svg></a><div class="toc-menus" id="toc-menus"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E6%8F%90%E6%9D%A1%E4%BB%B6"><span class="toc-number">1.</span> <span class="toc-text">前提条件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E8%8E%B7%E5%8F%96CFKEY"><span class="toc-number">1.1.</span> <span class="toc-text">1. 获取CFKEY</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E8%AE%BE%E7%BD%AE%E7%94%A8%E4%BA%8E-DDNS-%E8%A7%A3%E6%9E%90%E7%9A%84%E4%BA%8C%E7%BA%A7%E5%9F%9F%E5%90%8D"><span class="toc-number">1.2.</span> <span class="toc-text">2. 设置用于 DDNS 解析的二级域名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E4%B8%8B%E8%BD%BD-DDNS-%E8%84%9A%E6%9C%AC"><span class="toc-number">1.3.</span> <span class="toc-text">3. 下载 DDNS 脚本</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E4%BF%AE%E6%94%B9-DDNS-%E8%84%9A%E6%9C%AC%E5%B9%B6%E5%A1%AB%E5%86%99%E7%9B%B8%E5%85%B3%E4%BF%A1%E6%81%AF"><span class="toc-number">1.4.</span> <span class="toc-text">4. 修改 DDNS 脚本并填写相关信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E8%84%9A%E6%9C%AC%E6%8E%88%E6%9D%83%E5%B9%B6%E6%89%A7%E8%A1%8C"><span class="toc-number">1.5.</span> <span class="toc-text">5. 脚本授权并执行</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E8%AE%BE%E7%BD%AE%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1"><span class="toc-number">1.6.</span> <span class="toc-text">6. 设置定时任务</span></a></li></ol></li></ol></div><article class="post post__with-toc content-card"><div class="post__header"></div><div class="post__content"><h3 id="前提条件"><a href="#前提条件" class="headerlink" title="前提条件"></a>前提条件</h3><p>要自建DDNS服务，首先必须要有自己的域名且域名已经接入 Cloudflare （即DNS为CF提供的地址），另外就是使用阿里云解析、DNSPOD云解析、Cloudflare云解析等服务，本次教程以 Cloudflare 为例。</p><h4 id="1-获取CFKEY"><a href="#1-获取CFKEY" class="headerlink" title="1. 获取CFKEY"></a>1. 获取CFKEY</h4><p>打开网页：<a target="_blank" rel="noopener" href="https://dash.cloudflare.com/profile">https://dash.cloudflare.com/profile</a></p><p>在页面下方找到【Global API Key】，点击右侧的View查看Key，并保存下来</p><p><img src="https://cdn.jsdelivr.net/gh/zzfiu/pic/img/blog/cf-1.png" class="lazy" data-srcset="https://cdn.jsdelivr.net/gh/zzfiu/pic/img/blog/cf-1.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABAQMAAAAl21bKAAAABlBMVEXMzMyWlpYU2uzLAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAACklEQVQImWNgAAAAAgAB9HFkpgAAAABJRU5ErkJggg==" alt="img"></p><h4 id="2-设置用于-DDNS-解析的二级域名"><a href="#2-设置用于-DDNS-解析的二级域名" class="headerlink" title="2. 设置用于 DDNS 解析的二级域名"></a>2. 设置用于 DDNS 解析的二级域名</h4><p>在 Cloudflare 中新建一个A记录，如：ddns.yourdomain.com，指向 1.1.1.1<br>（可随意指定，如123.123.123.123等等，主要用于后续查看 DDNS 是否生效）</p><p><img src="https://cdn.jsdelivr.net/gh/zzfiu/pic/img/blog/cf-2.png" class="lazy" data-srcset="https://cdn.jsdelivr.net/gh/zzfiu/pic/img/blog/cf-2.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABAQMAAAAl21bKAAAABlBMVEXMzMyWlpYU2uzLAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAACklEQVQImWNgAAAAAgAB9HFkpgAAAABJRU5ErkJggg==" alt="img"></p><h4 id="3-下载-DDNS-脚本"><a href="#3-下载-DDNS-脚本" class="headerlink" title="3. 下载 DDNS 脚本"></a>3. 下载 DDNS 脚本</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y wget &amp;&amp; wget  -N --no-check-certificate https://raw.githubusercontent.com/yulewang/cloudflare-api-v4-ddns/master/cf-v4-ddns.sh</span><br></pre></td></tr></table></figure><h4 id="4-修改-DDNS-脚本并填写相关信息"><a href="#4-修改-DDNS-脚本并填写相关信息" class="headerlink" title="4. 修改 DDNS 脚本并填写相关信息"></a>4. 修改 DDNS 脚本并填写相关信息</h4><p>您可在线使用 nano/vi/vim 等工具进行修改，也可以下载到本地进行修改再上传覆盖！<br>可以参考下面命令使用vi进行编辑</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi cf-v4-ddns.sh</span><br></pre></td></tr></table></figure><p>然后按小写字母 i 进入编辑模式</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> API key, see https://www.cloudflare.com/a/account/my-account,</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 这里填写上一步获取的CFKEY</span></span><br><span class="line">CFKEY=</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">输入你需要解析用来DDNS解析的根域名 eg: example.com，比如我的域名是123.com，那么此处填写123.com</span></span><br><span class="line">CFZONE=</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 登陆CF的Username, eg: user@example.com(即CF的登录邮箱)</span></span><br><span class="line">CFUSER=</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 填写用来DDNS解析的二级域名，与上面设置的要一致, eg: ddns.yourdomain.com（例 ddns.123.com）</span></span><br><span class="line">CFHOST=</span><br></pre></td></tr></table></figure><p>全部填写完毕后按左上角的Esc退出编辑模式，然后输入 :wq 它会自动保存并退出</p><h4 id="5-脚本授权并执行"><a href="#5-脚本授权并执行" class="headerlink" title="5. 脚本授权并执行"></a>5. 脚本授权并执行</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod +x cf-v4-ddns.sh</span><br><span class="line">./cf-v4-ddns.sh</span><br></pre></td></tr></table></figure><blockquote><p>如果脚本相关信息填写正确，输出内容会显示当前母鸡IP，登录 Cloudflare <strong>DNS选项</strong> 查看之前设置的 1.1.1.1 已变为母鸡IP</p></blockquote><h4 id="6-设置定时任务"><a href="#6-设置定时任务" class="headerlink" title="6. 设置定时任务"></a>6. 设置定时任务</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">输入 crontab -e  然后会弹出 vi 编辑界面，按小写字母 i 进入编辑模式，在文件里面添加一行：</span><br><span class="line"></span><br><span class="line">*/2 * * * * /root/cf-v4-ddns.sh &gt;/dev/null 2&gt;&amp;1</span><br></pre></td></tr></table></figure><p><strong>如果您需要日志文件，上述代码请替换成下面代码</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">\#如果您需要日志文件，输入下面命令</span><br><span class="line">*/2 * * * * /root/cf-v4-ddns.sh &gt;&gt; /var/log/cf-ddns.log 2&gt;&amp;1</span><br></pre></td></tr></table></figure><p>至此，教程结束！</p><p>转载至 <a target="_blank" rel="noopener" href="https://blog.natcloud.net/cf-ddns.html">https://blog.natcloud.net/cf-ddns.html</a></p></div><div class="post-footer__meta"><p>更新于 2021-05-22</p></div><div class="post-meta__cats"></div></article><div class="nav"><div class="nav__prev"><a href="/a2f2.html" class="nav__link"><div><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="24" height="24"><path d="M589.088 790.624 310.464 512l278.624-278.624 45.248 45.248L400.96 512l233.376 233.376z" fill="#808080"></path></svg></div><div><div class="nav__label">Previous Post</div><div class="nav__title">运营商链路简评&amp;鉴别（163/169/CN2等)</div></div></a></div><div class="nav__next"><a href="/16107.html" class="nav__link"><div><div class="nav__label">Next Post</div><div class="nav__title">Hello World</div></div><div><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="24" height="24"><path d="M434.944 790.624l-45.248-45.248L623.04 512l-233.376-233.376 45.248-45.248L713.568 512z" fill="#808080"></path></svg></div></a></div></div></main><footer class="footer"><p class="footer-copyright">Copyright © 2020&nbsp;-&nbsp;2021 <a href="/">���ӷ�</a></p><p>Powered by <a href="https://hexo.io" target="_blank">Hexo</a> | Theme - <a href="https://github.com/ChrAlpha/hexo-theme-cards" target="_blank">Cards</a></p></footer></div><script defer src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@17.1.0/dist/lazyload.min.js"></script><script>window.lazyLoadOptions={elements_selector:".lazy",threshold:0}</script></body></html>